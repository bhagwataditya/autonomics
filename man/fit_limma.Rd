% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/8_fit_limma.R, R/8_fit_lmx.R,
%   R/8_fit_wilcoxon.R
\name{fit_limma}
\alias{fit_limma}
\alias{.fit_limma}
\alias{fit_lm}
\alias{fit_lme}
\alias{fit_lmer}
\alias{fit_wilcoxon}
\title{Fit model and test for differential expression}
\usage{
fit_limma(
  object,
  subgroupvar = if ("subgroup" \%in\% svars(object)) "subgroup" else NULL,
  contrasts = NULL,
  formula = default_formula(object, subgroupvar, contrasts),
  drop = !slevels_clash(object, all.vars(formula)),
  design = create_design(object, formula = formula, drop = drop),
  coefs = if (is.null(contrasts)) colnames(design) else NULL,
  block = NULL,
  weightvar = if ("weights" \%in\% assayNames(object)) "weights" else NULL,
  statvars = c("effect", "p", "fdr"),
  sep = FITSEP,
  suffix = paste0(sep, "limma"),
  verbose = TRUE,
  plot = FALSE
)

.fit_limma(
  object,
  subgroupvar = if ("subgroup" \%in\% svars(object)) "subgroup" else NULL,
  contrasts = NULL,
  formula = default_formula(object, subgroupvar, contrasts),
  drop = if (slevels_clash(object, all.vars(formula))) FALSE else TRUE,
  design = create_design(object, formula = formula, drop = drop),
  coefs = if (is.null(contrasts)) colnames(design) else NULL,
  block = NULL,
  weightvar = if ("weights" \%in\% assayNames(object)) "weights" else NULL,
  statvars = c("effect", "p", "fdr"),
  sep = FITSEP,
  suffix = paste0(sep, "limma"),
  verbose = TRUE,
  plot = FALSE
)

fit_lm(
  object,
  subgroupvar = if ("subgroup" \%in\% svars(object)) "subgroup" else NULL,
  contrasts = NULL,
  formula = default_formula(object, subgroupvar, contrasts = NULL),
  drop = !slevels_clash(object, all.vars(formula)),
  block = NULL,
  weightvar = if ("weights" \%in\% assayNames(object)) "weights" else NULL,
  coefs = NULL,
  verbose = TRUE,
  plot = FALSE
)

fit_lme(
  object,
  subgroupvar = if ("subgroup" \%in\% svars(object)) "subgroup" else NULL,
  contrasts = NULL,
  formula = default_formula(object, subgroupvar, contrasts = NULL),
  drop = !slevels_clash(object, all.vars(formula)),
  block = NULL,
  weightvar = if ("weights" \%in\% assayNames(object)) "weights" else NULL,
  coefs = NULL,
  verbose = TRUE,
  plot = FALSE
)

fit_lmer(
  object,
  subgroupvar = if ("subgroup" \%in\% svars(object)) "subgroup" else NULL,
  contrasts = NULL,
  formula = default_formula(object, subgroupvar, contrasts = NULL),
  drop = !slevels_clash(object, all.vars(formula)),
  block = NULL,
  weightvar = if ("weights" \%in\% assayNames(object)) "weights" else NULL,
  coefs = NULL,
  verbose = TRUE,
  plot = FALSE
)

fit_wilcoxon(
  object,
  subgroupvar = if ("subgroup" \%in\% svars(object)) "subgroup" else NULL,
  contrasts = sprintf("\%s-\%s", slevels(object, subgroupvar)[-1], slevels(object,
    subgroupvar)[1]),
  formula = NULL,
  coefs = NULL,
  block = NULL,
  weightvar = NULL,
  verbose = TRUE,
  plot = FALSE
)
}
\arguments{
\item{object}{SummarizedExperiment}

\item{subgroupvar}{subgroup variable}

\item{contrasts}{NULL or character vector: coefficient contrasts to test
\itemize{
\item{c("t1-t0", "t2-t1", "t3-t2")}
\item{matrix(c("WT.t1-WT.t0", "WT.t2-WT.t1", "WT.t3-WT.t2"), \cr
     c("KD.t1-KD.t0", "KD.t2-KD.t1", "KD.t3-KD.t2"), nrow=2, byrow=TRUE)}
\item{list(matrix(c("WT.t1-WT.t0", "WT.t2-WT.t1", "WT.t3-WT.t2"), \cr
     c("KD.t1-KD.t0", "KD.t2-KD.t1", "KD.t3-KD.t2"), nrow=2, byrow=TRUE), \cr
     matrix(c("KD.t0-WT.t0", "KD.t1-WT.t1", "KD.t2-WT.t2", "KD.t3-WT.t3"),\cr
     nrow=1, byrow=TRUE))}}}

\item{formula}{modeling formula}

\item{design}{design matrix}

\item{coefs}{NULL or character vector: model coefficients to test}

\item{block}{block svar (or NULL)}

\item{weightvar}{NULL or name of weight matrix in assays(object)}

\item{statvars}{character vector: subset of c('effect', 'p', 'fdr', 't')}

\item{sep}{string: pvar separator  ("~" in "p~t2~limma")}

\item{suffix}{string: pvar suffix ("limma" in "p~t2~limma")}

\item{verbose}{whether to msg}

\item{plot}{whether to plot}
}
\value{
Updated SummarizedExperiment
}
\description{
Fit model and test for differential expression
}
\examples{
# classical: lm & limma
    require(magrittr)
    file <- download_data('atkin18.somascan.adat')
    object <- read_somascan(file, plot = FALSE, fit = NULL)
    object \%<>\% fit_limma()
    object \%<>\% fit_lm()
   #plot_contrast_venn(testmat(object, coef = 't2'))
    
# blocked: limma, lme, lmer
    object \%<>\% fit_limma(subgroupvar = 'subgroup', block = 'Subject_ID')
    object \%<>\% fit_lme(  subgroupvar = 'subgroup', block = 'Subject_ID')
   #object \%<>\% fit_lmer( subgroupvar = 'subgroup', block = 'Subject_ID') # slow
   #plot_contrast_venn(testmat(object, coef = 't3', fit = c('limma', 'lme')))
    
# flexible: limma contrasts
    object \%<>\% fit_limma(formula = ~subgroup,   block = 'Subject_ID', coefs = 't1') 
    object \%<>\% fit_limma(formula = ~0+subgroup, block = 'Subject_ID', contrasts = 't1-t0')
        # flexible, but only approximate
        # stat.ethz.ch/pipermail/bioconductor/2014-February/057682.html

# alternative coding: 
    stats::contrasts(object$subgroup) <- MASS::contr.sdif(levels(object$subgroup))
    object \%<>\% fit_limma(subgroupvar = 'subgroup', block = 'Subject_ID') # backward difs
    stats::contrasts(object$subgroup) <-stats::contr.treatment(levels(object$subgroup))
    object \%<>\% fit_limma(subgroupvar = 'subgroup', block = 'Subject_ID') # baseline difs
    
# non-parametric: wilcoxon
    object \%<>\% fit_limma(   subgroupvar = 'subgroup', block = 'Subject_ID')
    object \%<>\% fit_wilcoxon(subgroupvar = 'subgroup', block = 'Subject_ID')
}
