---
title: "Autonomics for Proteomics"
author: "Aditya M Bhagwat"
date: "`r Sys.Date()`"
output: BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{autonomics_for_proteomics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, cache = TRUE, fig.show = 'hold', fig.align = 'center')
```

This vignette demonstrates how to use `autonomics` for proteomics data analysis.

# MaxQuant ProteinGroups

## Samples

### Design

Fukuda et al. (2020) studied the embryonic development of zebrafish.  
They compared the proteome of 30-days-post-fertilization embryos to adults.


```{r, message = FALSE}
require(autonomics)
file <- download_data('fukuda20.proteingroups.txt')
object <- read_proteingroups(file, plot = FALSE)
sdt(object)[, 1:3]
```

### Principle Component Analysis

In an experiment with p quantified proteingroups, each sample can be thought of as a data point in a p-dimensional space. **Principal Component Analysis** projects these sample points onto that lower (e.g. 2) dimensional space which maximizes the variance between samples. This two-dimensional biplot greatly aids in comprehending the overall sample similarity structure, as shown below for the dataset under consideration, where subgroup is reassuringly observed to be the major source of variation.


```{r, message = FALSE, fig.width = 3.5, fig.height = 2.5, out.width = '50%', out.height = '50%'}
biplot(pca(object))
```

### Sample Distributions

```{r, message = FALSE, fig.with = 10, fig.height = 2.75}
require(ggplot2)
b <- plot_sample_boxplots(object)  + guides(fill = 'none')
v <- plot_sample_violins(object)   + guides(fill = 'none')
d <- plot_sample_densities(object) + guides(fill = 'none')
gridExtra::grid.arrange(b, v, d, nrow = 1)
```


## Features

### Filtering

```{r}
n <- analysis(object)$nfeature
```

**`r n[[5]]` proteingroups** (out of `r n[[1]]` identified) were retained for further analysis, after applying the following filters:


```{r, echo = FALSE}
require(data.table)
data.table(Filter = names(n), n = n)   # Filtering details
```

### Feature Distributions

```{r, message = FALSE, fig.with = 10, fig.height = 2.75}
require(ggplot2)
b <- plot_feature_boxplots(object)  + guides(fill = 'none')
v <- plot_feature_violins(  object) + guides(fill = 'none')
d <- plot_feature_densities(object) + guides(fill = 'none')
gridExtra::grid.arrange(b, v, d, nrow = 1)
```

## Values

### Missing values

#### Systematic and Random NA

```{r}
systematic <- sum(systematic_nas(object))
random     <-     sum(random_nas(object))
no         <-         sum(no_nas(object))
```


**`r systematic`** proteingroups have **systematic** NAs: missing completely in some subgroups but detected in others (for at least half of the samples). These represent potential switch-like responses. They require prior imputation for statistical analysis to return p (rather than NA) values. Note that the apparent systematic nature of these NAs can arise due to chance. Increasing sample size gives greater  confidence into the systematic nature of these NA values.

**`r random`** proteingroups have **random** NAs. They are missing in some samples, but the missingness is unrelated to subgroup. These samples do not require require imputation for statistical analyis to return pvalues.  

**`r no`** proteingroups have **no** NAs. They are present in all samples.  

#### Plotting NA structure
  
The NA structure can also be summarized graphically with either of the two functions below.  

```{r, echo = TRUE, results = 'hide', message = FALSE, fig.width = 6, fig.height = 3, out.width = '100%', out.height = '100%'}
p1 <- plot_sample_nas(object) + ggplot2::guides(fill = 'none')
p2 <- plot_subgroup_nas(object)
gridExtra::grid.arrange(p1, p2, nrow = 1)
```

`plot_sample_nas` shows NA structure at **sample** resolution, plotting systematic and random NAs (white) as well as full detections (bright color).  
`plot_subgroup_nas` summarizes NA structure at the **subgroup** level, differentiating systematic NA values (white) from random NA values and full detections (color).

#### Imputing systematic NAs

Proteingroups with systematic misses require prior imputation for statistical analysis to return pvalues (rather than missing values). 

```{r, echo = TRUE, results = 'hide', message = FALSE, fig.cap = 'Left: sample distributions, Right: detections'}
impute(object, plot = TRUE)
```
The sample distributions (left) show how imputed values are drawn from a normal distribution, 2.5 standard deviations away from the sample mean, 0.3 standard deviations wide.  

The detection plot (right) shows imputed values with a lighter color.

