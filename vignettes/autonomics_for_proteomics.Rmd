---
title: "Autonomics for Proteomics"
author: "Aditya M Bhagwat"
date: "`r Sys.Date()`"
output: BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{autonomics_for_proteomics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, cache = TRUE, fig.show = 'hold', fig.align = 'center')
```

This vignette demonstrates how to use `autonomics` for proteomics data analysis.


# Dataset

Fukuda et al. (2020) studied the embryonic development of zebrafish.  
They compared the proteome of 30-days-post-fertilization embryos to adults.


```{r, message = FALSE}
require(autonomics)
file <- download_data('fukuda20.proteingroups.txt')
object <- read_proteingroups(file, plot = FALSE)
sdt(object)[, 1:3]
```

# Filtered Features

```{r}
n <- analysis(object)$nfeature   # Filtering details
```

MaxQuant identified `r n[[1]]` proteingroups.  Filtered out were `r n[[1]]- n[[2]]` reverse hits, `r n[[2]] - n[[3]]` potential contaminants, `r n[[3]]-n[[4]]` proteingroups without quantitative value (for any sample) and `r n[[4]]-n[[5]]` without replication (within subgroup). This retained **`r n[[5]]` proteingroups** for further analysis.  


# Missing values

## Systematic versus Random

```{r}
systematic <- sum(systematic_nas(object))
random     <-     sum(random_nas(object))
no         <-         sum(no_nas(object))
```


**`r systematic`** proteingroups have **systematic** NAs: missing completely in some subgroups but detected in others (for at least half of the samples). These represent potential switch-like responses. They require prior imputation for statistical analysis to return p (rather than NA) values. Note that the apparent systematic nature of these NAs can arise due to chance. Increasing sample size gives greater  confidence into the systematic nature of these NA values.

**`r random`** proteingroups have **random** NAs. They are missing in some samples, but the missingness is unrelated to subgroup. These samples do not require require imputation for statistical analyis to return pvalues.  

**`r no`** proteingroups have **no** NAs. They are present in all samples.  

## Plotting the missingness structure
  
The NA structure can also be summarized graphically with either of the two functions below.  
The first function shows NA structure at **sample** resolution, plotting systematic and random NAs (white) as well as full detections (bright color).  
The second function summarizes NA structure at the **subgroup** level, differentiating systematic NA values (white) from random NA values and full detections (color).

```{r, echo = TRUE, results = 'hide', message = FALSE, fig.width = 6, fig.height = 3, out.width = '100%', out.height = '100%'}
p1 <- plot_sample_nas(object) + ggplot2::guides(fill = 'none')
p2 <- plot_subgroup_nas(object)
gridExtra::grid.arrange(p1, p2, nrow = 1)
```

## Imputating systematic NAs

Proteingroups with systematic misses require prior imputation for statistical analysis to return pvalues (rather than missing values). 

```{r, echo = TRUE, results = 'hide', message = FALSE, fig.cap = 'Left: sample distributions, Right: detections'}
impute(object, plot = TRUE)
```
The sample distributions (left) show how imputed values are drawn from a normal distribution, 2.5 standard deviations away from the sample mean, 0.3 standard deviations wide.  

The detection plot (right) shows imputed values with a lighter color.

# Principal Component Analysis 

```{r, echo = FALSE, results = 'hide', message = FALSE, fig.width = 4, fig.height = 4, out.width = '50%', out.height = '50%', fig.width = 5, fig.height = 4}
biplot(pca(object))
```
